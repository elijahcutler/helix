<!DOCTYPE html>
<html lang="en">
<head>
  <title>Minecraft Server Manager</title>
  <link href="output.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col items-center p-6">
  <div class="max-w-lg w-full">
    <h1 class="text-3xl font-bold mb-4 text-center">Minecraft Server Manager</h1>

    <!-- Create Container -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-md mb-6 text-center">
      <h2 class="text-2xl font-semibold mb-4">Create New Minecraft Server</h2>
      <form id="createContainerForm" class="space-y-4">
        <input type="text" name="name" placeholder="Container Name" required class="w-full p-2 rounded bg-gray-700 text-white" />
        <input type="text" name="version" placeholder="Minecraft Version (e.g., 1.20.1)" class="w-full p-2 rounded bg-gray-700 text-white" />
        
        <div id="envVars" class="space-y-2">
          <div>
            <input type="text" placeholder="ENV Variable Name" class="env-name w-1/2 p-2 rounded bg-gray-700 text-white" />
            <input type="text" placeholder="Value" class="env-value w-1/2 p-2 rounded bg-gray-700 text-white" />
          </div>
        </div>

        <button type="button" onclick="addEnvVar()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">
          Add ENV Variable
        </button>
        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded">Create</button>
      </form>
    </div>

    <!-- Tracked Containers -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-md mb-6 text-center">
      <h2 class="text-2xl font-semibold mb-4">Tracked Containers</h2>
      <ul id="containerList" class="list-disc list-inside text-left text-gray-300"></ul>
    </div>
  </div>

  <script>
    function addEnvVar() {
      const envVars = document.getElementById('envVars');
      const div = document.createElement('div');
      div.innerHTML = `
        <input type="text" placeholder="ENV Variable Name" class="env-name w-1/2 p-2 rounded bg-gray-700 text-white" />
        <input type="text" placeholder="Value" class="env-value w-1/2 p-2 rounded bg-gray-700 text-white" />
      `;
      envVars.appendChild(div);
    }

    document.getElementById('createContainerForm').onsubmit = async (e) => {
      e.preventDefault();

      const name = e.target.name.value;
      const version = e.target.version.value;

      const envNames = document.querySelectorAll('.env-name');
      const envValues = document.querySelectorAll('.env-value');
      const envVars = {};

      envNames.forEach((el, index) => {
        const key = el.value.trim();
        const value = envValues[index].value.trim();
        if (key && value) {
          envVars[key] = value;
        }
      });

      try {
        const response = await fetch('/create-container', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, version, envVars }),
        });
        const data = await response.json();
        alert(data.message);
        fetchContainers(); // Refresh container list
      } catch (err) {
        console.error('Error creating container:', err);
        alert('Failed to create container.');
      }
    };

    async function fetchContainers() {
      const response = await fetch('/list-containers');
      const containers = await response.json();
      const containerList = document.getElementById('containerList');
      containerList.innerHTML = '';

      containers.forEach(container => {
        const li = document.createElement('li');
        li.textContent = `${container.name} (Version: ${container.version}) - ${container.status}`;

        const actions = ['start', 'stop', 'delete', 'logs'].map(action => {
          const button = document.createElement('button');
          button.textContent = action.charAt(0).toUpperCase() + action.slice(1);
          button.className = `ml-2 bg-${action === 'start' ? 'green' : action === 'stop' ? 'red' : 'blue'}-500 hover:bg-${
            action === 'start' ? 'green' : action === 'stop' ? 'red' : 'blue'
          }-600 text-white py-1 px-2 rounded`;

          button.onclick = () => {
            if (action === 'logs') viewLogs(container.id);
            else manageContainer(action, container.id);
          };
          return button;
        });

        actions.forEach(button => li.appendChild(button));
        containerList.appendChild(li);
      });
    }

    async function manageContainer(action, id) {
      try {
        const response = await fetch(`/${action}-container`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id }),
        });
        const data = await response.json();
        alert(data.message);
        fetchContainers();
      } catch (err) {
        console.error(`Error performing ${action}:`, err);
      }
    }

    async function viewLogs(id) {
      const response = await fetch(`/container-logs/${id}`);
      const data = await response.json();
      alert(data.logs);
    }

    fetchContainers(); // Load containers on page load
  </script>
</body>
</html>
