<!DOCTYPE html>
<html lang="en">
<head>
  <title>Minecraft Server Manager</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Minecraft Server Manager</h1>

    <!-- Create Container -->
    <div class="section">
      <h2>Create New Minecraft Server</h2>
      <form id="createContainerForm">
        <input type="text" name="name" placeholder="Container Name" required class="input" />
        
        <!-- Memory Slider -->
        <label for="memory">Memory Allocation:</label>
        <input type="range" id="memorySlider" min="1" max="8" step="1" value="2" class="input" />
        <span id="memoryValue">2G</span>

        <!-- ENV Variables -->
        <div id="envVars">
          <div>
            <input type="text" placeholder="ENV Variable Name" class="input env-name" />
            <input type="text" placeholder="Value" class="input env-value" />
          </div>
        </div>
        <button type="button" class="button" onclick="addEnvVar()">Add ENV Variable</button>
        <button type="submit" class="button">Create</button>
      </form>
    </div>

    <!-- Tracked Containers -->
    <div class="section">
      <h2>Tracked Containers</h2>
      <ul id="containerList" class="list-item"></ul>
    </div>
  </div>

  <script>
    document.getElementById('memorySlider').addEventListener('input', function () {
      document.getElementById('memoryValue').textContent = `${this.value}G`;
    });

    function addEnvVar() {
      const envVars = document.getElementById('envVars');
      const div = document.createElement('div');
      div.innerHTML = `
        <input type="text" placeholder="ENV Variable Name" class="input env-name" />
        <input type="text" placeholder="Value" class="input env-value" />
      `;
      envVars.appendChild(div);
    }

    document.getElementById('createContainerForm').onsubmit = async (e) => {
      e.preventDefault();

      const name = e.target.name.value;
      const memory = `${document.getElementById('memorySlider').value}G`;
      const envVars = { MEMORY: memory };

      const envNames = document.querySelectorAll('.env-name');
      const envValues = document.querySelectorAll('.env-value');

      envNames.forEach((el, i) => {
        const key = el.value.trim();
        const value = envValues[i].value.trim();
        if (key && value) {
          envVars[key] = value;
        }
      });

      const payload = { name, envVars };

      try {
        const response = await fetch('/create-container', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const result = await response.json();
        alert(response.ok ? result.message : result.error);
      } catch (err) {
        console.error('Error creating container:', err);
        alert('Failed to create container.');
      }
    };
  </script>
</body>
</html>